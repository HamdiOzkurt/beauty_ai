-- 1. ŞİRKETLER (SALONLAR)
CREATE TABLE tSirketler (
    Id SERIAL PRIMARY KEY,
    Ad VARCHAR(50) NOT NULL,
    Adres TEXT,
    TelNo VARCHAR(10),
    OlusturulmaTarihi TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 2. MÜŞTERİLER
CREATE TABLE tMusteriler (
    Id SERIAL PRIMARY KEY,
    SirketId INT REFERENCES tSirketler(Id), -- Müşteri hangi salona ait
    Ad VARCHAR(50) NOT NULL,
    Soyad VARCHAR(25) NOT NULL,
    TelNo CHAR(10) NOT NULL,
    KayitTarihi TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    SonZiyaretTarihi TIMESTAMP
);

-- 3. HİZMETLER (SERVICES)
CREATE TABLE tHizmetler (
    Id SERIAL PRIMARY KEY,
    SirketId INT REFERENCES tSirketler(Id),
    Ad VARCHAR(50) NOT NULL,
    Aciklama TEXT,
    SureDakika INT NOT NULL, -- Randevu planlaması için kritik (örn: 45 dk)
    Fiyat DECIMAL(10, 2) NOT NULL,
    AktifMi BOOLEAN DEFAULT TRUE
);



-- 5. PERSONEL (EXPERTS)
CREATE TABLE tPersonel (
    Id SERIAL PRIMARY KEY,
    SirketId INT REFERENCES tSirketler(Id),
    Ad VARCHAR(50) NOT NULL,
    Soyad VARCHAR(25) NOT NULL,
    UzmanlikAlani VARCHAR(50), -- Örn: "Saç Uzmanı", "Cilt Bakım Uzmanı"
    CalisiyorMu BOOLEAN DEFAULT TRUE
);

-- 6. PERSONEL - HİZMET EŞLEŞTİRMESİ
CREATE TABLE tPersonelHizmetleri (
    PersonelId INT REFERENCES tPersonel(Id),
    HizmetId INT REFERENCES tHizmetler(Id),
    PRIMARY KEY (PersonelId, HizmetId)
);

-- 7. KAMPANYALAR
CREATE TABLE tKampanyalar (
    Id SERIAL PRIMARY KEY,
    SirketId INT REFERENCES tSirketler(Id),
    KampanyaAdi VARCHAR(150),
    Kod VARCHAR(20), -- Örn: YAZ2024
    IndirimOrani DECIMAL(5, 2), -- Örn: 10.00 (%10)
    BaslangicTarihi DATE,
    BitisTarihi DATE
);

-- 8. RANDEVULAR
CREATE TABLE tRandevular (
    Id SERIAL PRIMARY KEY,
    SirketId INT REFERENCES tSirketler(Id),
    MusteriId INT REFERENCES tMusteriler(Id),
    PersonelId INT REFERENCES tPersonel(Id), -- Randevu kiminle?
    HizmetId INT REFERENCES tHizmetler(Id),  -- Hangi işlem?
    TarihSaat TIMESTAMP NOT NULL, -- Randevu zamanı
    BitisSaat TIMESTAMP NOT NULL, -- Başlangıç + Hizmet Süresi
    Durum VARCHAR(20) DEFAULT 'Onaylandı', -- İptal ve Onaylandı
    KampanyaId INT REFERENCES tKampanyalar(Id), 
    KonusmaGecmisi JSONB, 
    Notlar TEXT, -- Müşterinin özel istekleri
    OlusturulmaTarihi TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);